# Vue 响应式原理

## 如何追踪变化

* 将 JS 对象赋值给 data 选项时，Vue 将遍历此对象所有的属性，并使用 Object.defineProperty 把属性转化为 getter/setter。在内部作为 Vue 的追踪依赖，在属性被访问和修改时通知变化。
* 每个组件实例都有相应的 watcher 实例对象，它会在组件渲染的过程中把属性记录为依赖，之后当依赖项的 setter 被调用时，会通知 watcher 重新计算，从而使它关联的组件得以更新。

## 检测变化的注意事项

* 受现代 JavaScript 的限制，Vue 不能检测到对象属性的添加或删除。由于 Vue 会在初始化实例时对属性执行 getter/setter 转化过程，属性必须在 data 对象上存在才能让 Vue 转换它，这样才能让它是响应的。
* Vue.set(object, key, value) / vm.set(vm.object, key, value) 方法将响应属性添加到嵌套的对象上
* 给已有对象添加多个属性：Object.assign() / _.extend()：创建一个新的对象，让它包含原对象的属性和新的属性

## 声明响应式属性

* Vue 不允许动态添加**根级**响应式属性，必须在初始化实例前声明根级响应式属性，哪怕一个空值

## 异步更新队列

* Vue 异步执行 DOM 更新。只要观察到数据变化，开启一个队列并缓冲在同一事件循环中发生的所有数据改变。如果同一个 watcher 被多次触发，只会被推入到队列中一次。这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作是非常重要的
* 在数据变化之后等待 Vue 完成更新 DOM，可在数据变化时调用：Vue.nextTick(callback)，该函数返回一个 Promise 对象
